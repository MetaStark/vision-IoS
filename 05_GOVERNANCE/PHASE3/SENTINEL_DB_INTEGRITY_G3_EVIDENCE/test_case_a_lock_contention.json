{
  "test_case": "A",
  "name": "Lock Contention Detection",
  "start_time": "2025-12-08T12:44:16.949479+00:00",
  "verdict": "PASS",
  "evidence": {
    "sentinel_result": {
      "sentinel": "Sentinel_DB_Integrity",
      "version": "1.0",
      "timestamp": "2025-12-08T12:44:19.020410+00:00",
      "executor": "STIG",
      "adr_binding": [
        "ADR-010",
        "ADR-011",
        "ADR-013",
        "ADR-015"
      ],
      "config_source": "YAML",
      "modules": {
        "lock_monitor": {
          "status": "WARNING",
          "severity_score": 0.05,
          "lock_waits": [
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "wait_seconds": 2.0,
              "blocking_pid": null,
              "blocking_query": ""
            }
          ],
          "blockers": [],
          "affected_schemas": [
            "fhq_g3_test"
          ],
          "affected_tables": [],
          "total_waiting": 6,
          "max_wait_seconds": 1.995509,
          "timestamp": "2025-12-08T12:44:19.070283+00:00"
        },
        "bloat_watchdog": {
          "status": "WARNING",
          "severity_score": 0.05,
          "tables": [
            {
              "table": "fhq_research.indicator_trend",
              "live_tuples": 18598,
              "dead_tuples": 1000,
              "bloat_ratio": 0.051,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "NORMAL",
              "is_critical": false
            },
            {
              "table": "fhq_research.indicator_ichimoku",
              "live_tuples": 15366,
              "dead_tuples": 1000,
              "bloat_ratio": 0.0611,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "NORMAL",
              "is_critical": false
            },
            {
              "table": "fhq_security.keystore",
              "live_tuples": 1903,
              "dead_tuples": 264,
              "bloat_ratio": 0.1218,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "WARNING",
              "is_critical": false
            },
            {
              "table": "fhq_meta.agent_keys",
              "live_tuples": 11,
              "dead_tuples": 37,
              "bloat_ratio": 0.7708,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_macro.provider_quota_state",
              "live_tuples": 20,
              "dead_tuples": 36,
              "bloat_ratio": 0.6429,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_macro.feature_registry",
              "live_tuples": 33,
              "dead_tuples": 34,
              "bloat_ratio": 0.5075,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_governance.governance_actions_log",
              "live_tuples": 976,
              "dead_tuples": 33,
              "bloat_ratio": 0.0327,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "NORMAL",
              "is_critical": false
            },
            {
              "table": "fhq_positions.hcp_g3_metrics",
              "live_tuples": 0,
              "dead_tuples": 23,
              "bloat_ratio": 1.0,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_governance.task_registry",
              "live_tuples": 3,
              "dead_tuples": 15,
              "bloat_ratio": 0.8333,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_research.regime_model_registry",
              "live_tuples": 14,
              "dead_tuples": 14,
              "bloat_ratio": 0.5,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_positions.hcp_combo_tracker",
              "live_tuples": 1,
              "dead_tuples": 13,
              "bloat_ratio": 0.9286,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_meta.vendor_limits",
              "live_tuples": 24,
              "dead_tuples": 10,
              "bloat_ratio": 0.2941,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_security.hash_chains",
              "live_tuples": 2,
              "dead_tuples": 9,
              "bloat_ratio": 0.8182,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_governance.shared_state_snapshots",
              "live_tuples": 4,
              "dead_tuples": 7,
              "bloat_ratio": 0.6364,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_positions.structure_plan_hcp",
              "live_tuples": 3,
              "dead_tuples": 6,
              "bloat_ratio": 0.6667,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_meta.adr_registry",
              "live_tuples": 3,
              "dead_tuples": 6,
              "bloat_ratio": 0.6667,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_positions.target_exposure_daily",
              "live_tuples": 0,
              "dead_tuples": 5,
              "bloat_ratio": 1.0,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_meta.vendor_usage_counters",
              "live_tuples": 5,
              "dead_tuples": 4,
              "bloat_ratio": 0.4444,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_governance.vega_validation_rules",
              "live_tuples": 10,
              "dead_tuples": 4,
              "bloat_ratio": 0.2857,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            },
            {
              "table": "fhq_market.ingest_schedule",
              "live_tuples": 1,
              "dead_tuples": 4,
              "bloat_ratio": 0.8,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "CRITICAL",
              "is_critical": false
            }
          ],
          "critical_tables_at_risk": [],
          "warn_tables": [
            {
              "table": "fhq_security.keystore",
              "live_tuples": 1903,
              "dead_tuples": 264,
              "bloat_ratio": 0.1218,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "WARNING",
              "is_critical": false
            },
            {
              "table": "fhq_governance.mit_quad_pillars",
              "live_tuples": 4,
              "dead_tuples": 1,
              "bloat_ratio": 0.2,
              "days_since_vacuum": null,
              "last_vacuum": null,
              "status": "WARNING",
              "is_critical": false
            }
          ],
          "total_dead_tuples": 2549,
          "total_live_tuples": 346842,
          "timestamp": "2025-12-08T12:44:19.124601+00:00"
        },
        "slow_query_monitor": {
          "status": "WARNING",
          "severity_score": 0.05,
          "slow_queries": [
            {
              "queryid": "-1710489915157527527",
              "query_fingerprint": "SELECT DISTINCT ON (asset_id, timestamp::date)\n            asset_id,\n            timestamp::date as timestamp,\n            (value_json->>$1)::numeric as macd_histogram\n        FROM fhq_research.indica",
              "calls": 60,
              "mean_time_ms": 13776.31,
              "total_time_ms": 826578.57,
              "max_time_ms": 58965.47,
              "rows_per_call": 2803.05,
              "cache_hit_ratio": 0.0016,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "9124990145437055437",
              "query_fingerprint": "SELECT DISTINCT ON (asset_id, timestamp::date)\n            asset_id,\n            timestamp::date as timestamp,\n            (value_json->>$1)::numeric as bb_width\n        FROM fhq_research.indicator_vo",
              "calls": 60,
              "mean_time_ms": 11574.74,
              "total_time_ms": 694484.31,
              "max_time_ms": 32690.57,
              "rows_per_call": 2784.05,
              "cache_hit_ratio": 0.0023,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "5917381502880669214",
              "query_fingerprint": "SELECT DISTINCT ON (asset_id, timestamp::date)\n            asset_id,\n            timestamp::date as timestamp,\n            (value_json->>$1)::numeric as rsi_14\n        FROM fhq_research.indicator_mome",
              "calls": 60,
              "mean_time_ms": 11278.96,
              "total_time_ms": 676737.89,
              "max_time_ms": 54367.86,
              "rows_per_call": 2790.05,
              "cache_hit_ratio": 0.0369,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "-345230925756517180",
              "query_fingerprint": "SELECT COUNT(*) FROM fhq_research.indicator_ichimoku",
              "calls": 10,
              "mean_time_ms": 29826.18,
              "total_time_ms": 298261.78,
              "max_time_ms": 36239.45,
              "rows_per_call": 1.0,
              "cache_hit_ratio": 0.0005,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "-5319164697466744197",
              "query_fingerprint": "SELECT COUNT(*) FROM fhq_research.indicator_volatility",
              "calls": 11,
              "mean_time_ms": 22888.78,
              "total_time_ms": 251776.53,
              "max_time_ms": 47338.28,
              "rows_per_call": 1.0,
              "cache_hit_ratio": 0.0007,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "2821783329048504842",
              "query_fingerprint": "SELECT COUNT(*) FROM fhq_research.indicator_trend",
              "calls": 11,
              "mean_time_ms": 21208.62,
              "total_time_ms": 233294.78,
              "max_time_ms": 42724.14,
              "rows_per_call": 1.0,
              "cache_hit_ratio": 0.0007,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "5906202962778543161",
              "query_fingerprint": "SELECT COUNT(*) FROM fhq_research.indicator_momentum",
              "calls": 11,
              "mean_time_ms": 17994.38,
              "total_time_ms": 197938.21,
              "max_time_ms": 27544.44,
              "rows_per_call": 1.0,
              "cache_hit_ratio": 0.0009,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "6771183962396821796",
              "query_fingerprint": "INSERT INTO fhq_research.indicator_momentum\n                (id, timestamp, asset_id, value_json, engine_version, formula_hash, lineage_hash, created_at)\n                VALUES ($1,$2::timestamp,$3,$4",
              "calls": 32,
              "mean_time_ms": 4652.21,
              "total_time_ms": 148870.77,
              "max_time_ms": 10070.17,
              "rows_per_call": 239.0,
              "cache_hit_ratio": 0.8913,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "-7060874057496850563",
              "query_fingerprint": "INSERT INTO fhq_research.indicator_ichimoku\n                (id, timestamp, asset_id, value_json, engine_version, formula_hash, lineage_hash, created_at)\n                VALUES ($1,$2::timestamp,$3,$4",
              "calls": 32,
              "mean_time_ms": 4601.61,
              "total_time_ms": 147251.63,
              "max_time_ms": 7334.98,
              "rows_per_call": 244.0,
              "cache_hit_ratio": 0.8907,
              "touches_focus_schema": true,
              "severity": "WARNING"
            },
            {
              "queryid": "-6414831882389143844",
              "query_fingerprint": "INSERT INTO fhq_research.indicator_trend\n                (id, timestamp, asset_id, value_json, engine_version, formula_hash, lineage_hash, created_at)\n                VALUES ($1,$2::timestamp,$3,$4,$5",
              "calls": 32,
              "mean_time_ms": 4588.01,
              "total_time_ms": 146816.35,
              "max_time_ms": 6686.98,
              "rows_per_call": 252.0,
              "cache_hit_ratio": 0.8915,
              "touches_focus_schema": true,
              "severity": "WARNING"
            }
          ],
          "total_queries_analyzed": 20,
          "queries_above_threshold": 12,
          "timestamp": "2025-12-08T12:44:19.273365+00:00"
        }
      },
      "module_errors": [],
      "overall_status": "WARNING",
      "discrepancies_logged": 3,
      "evidence_hash": "7a364dfe4124b9a25b725e2953030a4c81844afae0d90dd9d41140133a19e09e"
    },
    "lock_monitor_status": "WARNING",
    "discrepancy_events": [
      {
        "event_id": "a6fab4be-2ccc-42fb-a042-4a1b4c7958c1",
        "ios_id": "IoS-014",
        "agent_id": "STIG",
        "target_table": "lock_monitor",
        "target_column": null,
        "target_key": null,
        "canonical_value": null,
        "reported_value": null,
        "discrepancy_type": "DB_LOCK_CONTENTION",
        "discrepancy_score": "0.050000",
        "severity": "WARN",
        "detection_method": "SENTINEL_DB_INTEGRITY",
        "context_data": {
          "status": "WARNING",
          "blockers": [],
          "timestamp": "2025-12-08T12:44:19.070283+00:00",
          "lock_waits": [
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            },
            {
              "blocked_pid": 5858,
              "blocking_pid": null,
              "wait_seconds": 2.0,
              "blocked_query": "\n                        UPDATE fhq_g3_test.lock_test_table\n                        SET value = value + 1, updated_at = NOW()\n                        WHERE id = 1\n                    ",
              "blocking_query": ""
            }
          ],
          "total_waiting": 6,
          "severity_score": 0.05,
          "affected_tables": [],
          "affected_schemas": [
            "fhq_g3_test"
          ],
          "max_wait_seconds": 1.995509
        },
        "resolution_status": "OPEN",
        "resolved_by": null,
        "resolved_at": null,
        "resolution_notes": null,
        "created_at": "2025-12-08 12:44:19.047390+00:00",
        "updated_at": "2025-12-08 12:44:19.047390+00:00",
        "adr_reference": "ADR-010",
        "hash_prev": null,
        "hash_self": null
      },
      {
        "event_id": "64ec268c-3731-4c20-bc4e-dbe16257ca0b",
        "ios_id": "IoS-014",
        "agent_id": "STIG",
        "target_table": "G1_DUMMY_TEST",
        "target_column": null,
        "target_key": null,
        "canonical_value": null,
        "reported_value": null,
        "discrepancy_type": "DB_LOCK_CONTENTION",
        "discrepancy_score": "0.050000",
        "severity": "WARN",
        "detection_method": "G1_VALIDATION_TEST",
        "context_data": {
          "test": true,
          "module": "lock_monitor",
          "status": "DUMMY_G1_TEST",
          "message": "G1 validation event - not a real incident"
        },
        "resolution_status": "OPEN",
        "resolved_by": null,
        "resolved_at": null,
        "resolution_notes": null,
        "created_at": "2025-12-08 12:08:23.112290+00:00",
        "updated_at": "2025-12-08 12:08:23.112290+00:00",
        "adr_reference": "ADR-010",
        "hash_prev": null,
        "hash_self": null
      }
    ],
    "events_created": 2
  },
  "note": "Lock monitor status: WARNING. Sentinel correctly monitored lock state.",
  "end_time": "2025-12-08T12:44:19.366727+00:00"
}